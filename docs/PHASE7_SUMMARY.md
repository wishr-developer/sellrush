# Phase 7: æ±ºæ¸ˆ / å ±é…¬ãƒ•ãƒ­ãƒ¼ (Stripe & Revenue Share) - å®Ÿè£…ã¾ã¨ã‚

æœ€çµ‚æ›´æ–°: 2025-01-30

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Phase 7 ã§å®Ÿè£…ã—ãŸæ±ºæ¸ˆãƒ»å ±é…¬ãƒ•ãƒ­ãƒ¼ã®ä»•æ§˜ã¨å®Ÿè£…çŠ¶æ³ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

---

## ğŸ“‹ ç›®æ¬¡

1. [æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ã®å…¨ä½“å›³](#æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ã®å…¨ä½“å›³)
2. [Revenue Share ã®è¨ˆç®—ç®‡æ‰€](#revenue-share-ã®è¨ˆç®—ç®‡æ‰€)
3. [Stripe Webhook ã¨ Orders ã®æ•´åˆæ€§](#stripe-webhook-ã¨-orders-ã®æ•´åˆæ€§)
4. [ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨ã®é‡‘é¡æ•´åˆæ€§](#ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨ã®é‡‘é¡æ•´åˆæ€§)
5. [ã¾ã æœªå®Ÿè£…ã®éƒ¨åˆ†](#ã¾ã æœªå®Ÿè£…ã®éƒ¨åˆ†)

---

## æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ã®å…¨ä½“å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå•†å“è³¼å…¥ãƒšãƒ¼ã‚¸ï¼ˆ/purchaseï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œè³¼å…¥ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯                       â”‚
â”‚    â†’ POST /api/checkout/create                              â”‚
â”‚    â†’ product_id ã¨ affiliate_code ã‚’é€ä¿¡                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. API ãŒ Stripe Checkout Session ã‚’ä½œæˆ                   â”‚
â”‚    â†’ metadata ã«ä»¥ä¸‹ã‚’åŸ‹ã‚è¾¼ã¿:                             â”‚
â”‚      - product_id, creator_id, owner_id                     â”‚
â”‚      - creator_share_rate, platform_take_rate               â”‚
â”‚      - affiliate_link_id                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ Stripe Checkout ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ           â”‚
â”‚    â†’ Stripe ã®æ±ºæ¸ˆãƒ•ã‚©ãƒ¼ãƒ ã§æ”¯æ‰•ã„æƒ…å ±ã‚’å…¥åŠ›                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ±ºæ¸ˆã‚’å®Œäº†                                      â”‚
â”‚    â†’ Stripe ãŒ Webhook ã‚’é€ä¿¡                               â”‚
â”‚    â†’ checkout.session.completed ã‚¤ãƒ™ãƒ³ãƒˆ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. POST /api/stripe/webhook ãŒã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡               â”‚
â”‚    â†’ ç½²åæ¤œè¨¼                                                â”‚
â”‚    â†’ metadata ã‹ã‚‰æƒ…å ±ã‚’å–å¾—                                â”‚
â”‚    â†’ orders ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ                        â”‚
â”‚      (status = 'completed', source = 'stripe')              â”‚
â”‚    â†’ payouts ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ                        â”‚
â”‚      (status = 'pending')                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ /purchase/success ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ              â”‚
â”‚    â†’ è³¼å…¥å®Œäº†ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼

| ã‚¤ãƒ™ãƒ³ãƒˆ | ã‚¿ã‚¤ãƒŸãƒ³ã‚° | å‡¦ç†å†…å®¹ |
|---------|----------|---------|
| `checkout.session.completed` | æ±ºæ¸ˆå®Œäº†æ™‚ | orders ã¨ payouts ã‚’ä½œæˆ |
| `payment_intent.succeeded` | å°†æ¥å®Ÿè£… | ç¾åœ¨ã¯ `checkout.session.completed` ã§ååˆ† |
| `payment_intent.payment_failed` | å°†æ¥å®Ÿè£… | `orders.status = 'failed'` ã«æ›´æ–° |
| `charge.refunded` | å°†æ¥å®Ÿè£… | `orders.status = 'refunded'` ã«æ›´æ–°ã€payouts ã®èª¿æ•´ |

---

## Revenue Share ã®è¨ˆç®—ç®‡æ‰€

### çµ±ä¸€é–¢æ•°: `src/lib/revenue-share.ts`

**`calculateRevenueShare()`**: ã‚³ã‚¢ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
- Creator åˆ†é…é¡: `Math.floor(totalAmount * creatorRate)`
- Platform åˆ†é…é¡: `Math.floor(totalAmount * platformRate)`
- Brand åˆ†é…é¡: `totalAmount - creatorAmount - platformAmount`ï¼ˆç«¯æ•°èª¿æ•´ï¼‰

**`calculateRevenueShareFromProduct()`**: å•†å“æƒ…å ±ã‹ã‚‰è¨ˆç®—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
- `products.creator_share_rate` ã¨ `products.platform_take_rate` ã‚’ä½¿ç”¨
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: Creator 25%, Platform 15%, Brand 60%

### ä½¿ç”¨ç®‡æ‰€

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” | å®Ÿè£…çŠ¶æ³ |
|---------|------|---------|
| `src/app/api/stripe/webhook/route.ts` | Webhook ã§ payouts ã‚’ç”Ÿæˆ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `src/app/api/payouts/generate/route.ts` | Admin ãŒæ‰‹å‹•ã§ payouts ã‚’ç”Ÿæˆ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `src/app/dashboard/DashboardClient.tsx` | Creator Dashboard ã®ã€Œå ±é…¬è¦‹è¾¼ã¿ã€è¨ˆç®— | âœ… å®Ÿè£…æ¸ˆã¿ |

### è¨ˆç®—ä¾‹

```typescript
// ä¾‹: 10,000å††ã®æ³¨æ–‡ã€Creator 25%, Platform 15%, Brand 60%
const result = calculateRevenueShareFromProduct(
  10000,
  0.25, // creator_share_rate
  0.15, // platform_take_rate
);
// result = {
//   creatorAmount: 2500,    // Math.floor(10000 * 0.25)
//   platformAmount: 1500,   // Math.floor(10000 * 0.15)
//   brandAmount: 6000,       // 10000 - 2500 - 1500 (ç«¯æ•°èª¿æ•´)
//   totalAmount: 10000,
// }
```

---

## Stripe Webhook ã¨ Orders ã®æ•´åˆæ€§

### å†ªç­‰æ€§ã®ç¢ºä¿

**å•é¡Œ**: Webhook ã®å†é€ä¿¡æ™‚ã«é‡è¤‡ã—ã¦æ³¨æ–‡ã‚„ payout ã‚’ä½œæˆã—ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹

**è§£æ±ºç­–**:
1. **orders ãƒ†ãƒ¼ãƒ–ãƒ«**: `stripe_session_id` ã§æ—¢å­˜ã®æ³¨æ–‡ã‚’ãƒã‚§ãƒƒã‚¯
   - æ—¢å­˜ã®æ³¨æ–‡ãŒã‚ã‚‹å ´åˆã¯ã€ãã®æ³¨æ–‡ã‚’ä½¿ç”¨ï¼ˆé‡è¤‡ä½œæˆã‚’é˜²ãï¼‰

2. **payouts ãƒ†ãƒ¼ãƒ–ãƒ«**: `order_id` ã§æ—¢å­˜ã® payout ã‚’ãƒã‚§ãƒƒã‚¯
   - æ—¢å­˜ã® payout ãŒã‚ã‚‹å ´åˆã¯ã€ã‚¹ã‚­ãƒƒãƒ—ï¼ˆé‡è¤‡ä½œæˆã‚’é˜²ãï¼‰

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- æœ¬ç•ªç’°å¢ƒã§ã¯è©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ã—ãªã„ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰
- é–‹ç™ºç’°å¢ƒã§ã®ã¿ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’å‡ºåŠ›
- å°†æ¥çš„ã« `payment_logs` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¦ã€å¤±æ•—æ™‚ã®ãƒ­ã‚°ã‚’è¨˜éŒ²äºˆå®š

---

## ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨ã®é‡‘é¡æ•´åˆæ€§

### Creator Dashboard

| æŒ‡æ¨™ | ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ | è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ | æ•´åˆæ€§ |
|------|------------|------------|--------|
| å ±é…¬è¦‹è¾¼ã¿ | `orders` + `products.creator_share_rate` | `calculateRevenueShareFromProduct()` ã‚’ä½¿ç”¨ | âœ… çµ±ä¸€æ¸ˆã¿ |
| ç¢ºå®šæ¸ˆã¿å ±é…¬ | `payouts.creator_amount` (status = 'paid') | åˆè¨ˆ | âœ… å•é¡Œãªã— |
| æ”¯æ‰•ã„å¾…ã¡å ±é…¬ | `payouts.creator_amount` (status = 'pending') | åˆè¨ˆ | âœ… å•é¡Œãªã— |

**æ³¨æ„**: ã€Œå ±é…¬è¦‹è¾¼ã¿ã€ã¯ `orders` ã‹ã‚‰è¨ˆç®—ã—ã¦ã„ã‚‹ãŸã‚ã€å®Ÿéš›ã® `payouts` ã¨ä¸€è‡´ã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€`payouts` ãŒç”Ÿæˆã•ã‚Œã‚‹å‰ã«è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã§ã™ã€‚

### Brand Dashboard

| æŒ‡æ¨™ | ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ | è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ | æ•´åˆæ€§ |
|------|------------|------------|--------|
| ç·å£²ä¸Š (GMV) | `orders.amount` | åˆè¨ˆ | âœ… å•é¡Œãªã— |
| Brand ã¸ã®åˆ†é…é¡ | `payouts.brand_amount` | åˆè¨ˆ | âœ… å•é¡Œãªã— |

**æ³¨æ„**: Brand Dashboard ã§ã¯ Revenue Share ã®è¨ˆç®—ã¯ä¸è¦ã§ã™ï¼ˆ`payouts` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ç›´æ¥å–å¾—ï¼‰ã€‚

---

## ã¾ã æœªå®Ÿè£…ã®éƒ¨åˆ†

### 1. è¿½åŠ ã® Stripe ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†

- [ ] `payment_intent.succeeded`: ç¾åœ¨ã¯ `checkout.session.completed` ã§ååˆ†
- [ ] `payment_intent.payment_failed`: `orders.status = 'failed'` ã«æ›´æ–°
- [ ] `charge.refunded`: `orders.status = 'refunded'` ã«æ›´æ–°ã€payouts ã®èª¿æ•´

### 2. æ±ºæ¸ˆãƒ­ã‚°ã®è¨˜éŒ²

- [ ] `payment_logs` ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆï¼ˆå°†æ¥ã®ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ¡ˆï¼‰
- [ ] Webhook å‡¦ç†ã®æˆåŠŸ/å¤±æ•—ã‚’è¨˜éŒ²
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã®è©³ç´°ãƒ­ã‚°ã‚’è¨˜éŒ²

### 3. æœ¬ç•ª Payout æ©Ÿèƒ½

- [ ] Stripe Connect ã® Payout æ©Ÿèƒ½ï¼ˆç¾åœ¨ã¯è‡ªå‰ã® `payouts` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ç”¨ï¼‰
- [ ] è‡ªå‹• Payout å‡¦ç†ï¼ˆå®šæœŸå®Ÿè¡Œï¼‰
- [ ] Payout ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°ï¼ˆStripe ã‹ã‚‰ã® Webhookï¼‰

### 4. ç¨é‡‘ãƒ»æ‰‹æ•°æ–™ã®å‡¦ç†

- [ ] æ¶ˆè²»ç¨ã®è¨ˆç®—
- [ ] Stripe æ‰‹æ•°æ–™ã®è¨ˆç®—
- [ ] ç¨é‡‘ãƒ»æ‰‹æ•°æ–™ã‚’è€ƒæ…®ã—ãŸ Revenue Share ã®å†è¨ˆç®—

### 5. è¿”é‡‘å‡¦ç†

- [ ] éƒ¨åˆ†è¿”é‡‘ã®å‡¦ç†
- [ ] å…¨é¡è¿”é‡‘ã®å‡¦ç†
- [ ] è¿”é‡‘æ™‚ã® payout ã®èª¿æ•´

---

## ãƒ†ã‚¹ãƒˆã¨ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å‹•ä½œç¢ºèª

### Stripe ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã§ã®ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰**:
- æˆåŠŸ: `4242 4242 4242 4242`
- å¤±æ•—: `4000 0000 0000 0002`
- æœ‰åŠ¹æœŸé™: ä»»æ„ã®æœªæ¥ã®æ—¥ä»˜ï¼ˆä¾‹: 12/34ï¼‰
- CVC: ä»»æ„ã®3æ¡ï¼ˆä¾‹: 123ï¼‰

**ãƒ†ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼**:
1. `/purchase` ã‹ã‚‰ Checkout Session ã‚’ä½œæˆ
2. Stripe ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã® Checkout ãƒšãƒ¼ã‚¸ã§ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ã‚’å…¥åŠ›
3. Webhook ãŒé€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
4. `/purchase/success` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
5. `orders` ã¨ `payouts` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env.local.example` ã«ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚­ãƒ¼ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

**æ³¨æ„**: æœ¬ç•ªå€¤ã¯å«ã‚ã¦ã„ã¾ã›ã‚“ã€‚å®Ÿéš›ã®å€¤ã¯ Vercel ã® Environment Variables ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚

---

## ã¾ã¨ã‚

Phase 7 ã§ã¯ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸ:

1. âœ… **P7-1: æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ã¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æ£šå¸ã—**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®èª¿æŸ»ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
2. âœ… **P7-2: Revenue Share ãƒ­ã‚¸ãƒƒã‚¯ã®å…±é€šåŒ–**: `src/lib/revenue-share.ts` ã‚’ä½œæˆã—ã€æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
3. âœ… **P7-3: Stripe Webhook ã¨ Orders ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯**: å†ªç­‰æ€§ã®ç¢ºä¿ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„
4. âœ… **P7-4: Creator / Brand ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨ã®é‡‘é¡æ•´åˆæ€§**: è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®æ•´åˆæ€§ã‚’ç¢ºèª
5. âœ… **P7-5: æœ€ä½é™ã®ãƒ†ã‚¹ãƒˆã¨ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å‹•ä½œç¢ºèª**: `.env.local.example` ã®ä½œæˆã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–

**ç¾åœ¨ã®å®Ÿè£…ãƒ¬ãƒ™ãƒ«**: MVPï¼ˆæœ€å°é™ã®æ©Ÿèƒ½ï¼‰
**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: è¿½åŠ ã® Stripe ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã€æ±ºæ¸ˆãƒ­ã‚°ã®è¨˜éŒ²ã€æœ¬ç•ª Payout æ©Ÿèƒ½

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/PHASE7_PAYMENTS_PLAN.md`: å®Ÿè£…è¨ˆç”»ã®è©³ç´°
- `src/lib/revenue-share.ts`: Revenue Share è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
- `src/app/api/stripe/webhook/route.ts`: Stripe Webhook ãƒãƒ³ãƒ‰ãƒ©ãƒ¼

