# Phase 8-A: Arena / Tournament MVP å®Ÿè£…è¨ˆç”»

æœ€çµ‚æ›´æ–°: 2025-01-30

## ğŸ“‹ ç›®æ¬¡

1. [ç›®çš„](#ç›®çš„)
2. [æƒ³å®šã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹](#æƒ³å®šã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹)
3. [MVPã§ã‚µãƒãƒ¼ãƒˆã™ã‚‹å˜ä½](#mvpã§ã‚µãƒãƒ¼ãƒˆã™ã‚‹å˜ä½)
4. [å¿…è¦ãªæ¦‚å¿µ](#å¿…è¦ãªæ¦‚å¿µ)
5. [æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®æ´»ç”¨](#æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®æ´»ç”¨)
6. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
7. [APIè¨­è¨ˆ](#apiè¨­è¨ˆ)
8. [UIè¨­è¨ˆ](#uiè¨­è¨ˆ)
9. [å®Ÿè£…ã‚¿ã‚¹ã‚¯](#å®Ÿè£…ã‚¿ã‚¹ã‚¯)

---

## ç›®çš„

ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ã®è²©å£²æ´»å‹•ã‚’ã€Œãƒãƒˆãƒ« / ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã€ã¨ã—ã¦å¯è¦–åŒ–ã—ã€ç«¶äº‰ä½“é¨“ã‚’æä¾›ã™ã‚‹ã€‚

LP ä¸Šã§ã†ãŸã£ã¦ã„ã‚‹ã€ŒNIGHT TOURNAMENTã€ã‚„ã€ŒTonight Battleã€ãªã©ã®ã‚¢ãƒªãƒ¼ãƒŠ / ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆä½“é¨“ã‚’ã€å®Ÿéš›ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‹APIï¼‹DB ã«è½ã¨ã—è¾¼ã‚€ã€‚

---

## æƒ³å®šã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

### 1. ãƒŠã‚¤ãƒˆãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ
- **æœŸé–“**: ç‰¹å®šã®å¤œï¼ˆä¾‹: 2025-01-30 20:00 ã€œ 2025-01-31 02:00ï¼‰
- **å¯¾è±¡å•†å“**: 1å•†å“ï¼ˆä¾‹: é™å®šTã‚·ãƒ£ãƒ„ï¼‰
- **ãƒ«ãƒ¼ãƒ«**: æœŸé–“ä¸­ã®å£²ä¸Šé‡‘é¡ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°
- **å ±é…¬**: ä¸Šä½3åã«ãƒœãƒ¼ãƒŠã‚¹å ±é…¬

### 2. 24æ™‚é–“ãƒãƒˆãƒ«
- **æœŸé–“**: 24æ™‚é–“ï¼ˆä¾‹: 2025-01-30 00:00 ã€œ 2025-01-31 00:00ï¼‰
- **å¯¾è±¡å•†å“**: 1å•†å“ï¼ˆä¾‹: æ–°å•†å“ã®å…ˆè¡Œè²©å£²ï¼‰
- **ãƒ«ãƒ¼ãƒ«**: æœŸé–“ä¸­ã®å£²ä¸Šé‡‘é¡ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°
- **å ±é…¬**: 1ä½ã«ç‰¹åˆ¥å ±é…¬

### 3. é€±é–“ãƒãƒ£ãƒ¬ãƒ³ã‚¸
- **æœŸé–“**: 1é€±é–“ï¼ˆä¾‹: 2025-01-30 00:00 ã€œ 2025-02-06 00:00ï¼‰
- **å¯¾è±¡å•†å“**: 1å•†å“ï¼ˆä¾‹: äººæ°—å•†å“ã®å†è²©ï¼‰
- **ãƒ«ãƒ¼ãƒ«**: æœŸé–“ä¸­ã®å£²ä¸Šé‡‘é¡ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°
- **å ±é…¬**: ä¸Šä½10åã«ãƒœãƒ¼ãƒŠã‚¹å ±é…¬

**æ³¨æ„**: MVP ã§ã¯ã€Œ1å•†å“ Ã— 1æœŸé–“ = 1ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã€ã®ã¿ã‚µãƒãƒ¼ãƒˆã€‚è¤‡æ•°å•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã¯å°†æ¥ã®æ‹¡å¼µã¨ã™ã‚‹ã€‚

---

## MVPã§ã‚µãƒãƒ¼ãƒˆã™ã‚‹å˜ä½

### æœ€å°é™ã®æ©Ÿèƒ½

1. **ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆä½œæˆ**
   - Brand / Admin ãŒãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’ä½œæˆå¯èƒ½
   - 1ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ = 1å•†å“ + 1æœŸé–“

2. **ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º**
   - å£²ä¸Šé‡‘é¡ï¼ˆ`orders.amount`ï¼‰ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°
   - æœŸé–“ï¼ˆ`start_at` ã€œ `end_at`ï¼‰ã¨å•†å“ï¼ˆ`product_id`ï¼‰ã§ãƒ•ã‚£ãƒ«ã‚¿
   - ã‚¯ãƒªãƒƒã‚¯æ•°ãƒ»CVR ã¯å°†æ¥ã®æŒ‡æ¨™ã¨ã—ã¦å¾Œå›ã—

3. **å‚åŠ è€…è¡¨ç¤º**
   - ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆæœŸé–“ä¸­ã«æ³¨æ–‡ãŒã‚ã£ãŸ Creator ã‚’è‡ªå‹•çš„ã«å‚åŠ è€…ã¨ã—ã¦è¡¨ç¤º
   - æ˜ç¤ºçš„ãªã€Œå‚åŠ ç™»éŒ²ã€ã¯ä¸è¦ï¼ˆæ³¨æ–‡ãŒã‚ã‚Œã°è‡ªå‹•å‚åŠ ï¼‰

4. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±åˆ**
   - Creator Dashboard: ç¾åœ¨å‚åŠ ä¸­ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã¨è‡ªåˆ†ã®é †ä½ã‚’è¡¨ç¤º
   - Brand Dashboard: è‡ªç¤¾å•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆçŠ¶æ³ã‚’è¡¨ç¤º

### å°†æ¥ã®æ‹¡å¼µï¼ˆMVPã§ã¯å®Ÿè£…ã—ãªã„ï¼‰

- è¤‡æ•°å•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ
- ãƒãƒ¼ãƒ ãƒãƒˆãƒ«
- è³é‡‘ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç¾åœ¨ã¯å ±é…¬è¦‹è¾¼ã¿ã®ã¿ï¼‰
- ã‚¯ãƒªãƒƒã‚¯æ•°ãƒ»CVR ãªã©ã®æŒ‡æ¨™
- Fraud Radar ã¨ã®é€£æºå¼·åŒ–

---

## å¿…è¦ãªæ¦‚å¿µ

### 1. Tournamentï¼ˆãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆï¼‰

è²©å£²ãƒãƒˆãƒ« / ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã®å®šç¾©ã€‚

**å±æ€§**:
- `id`: UUIDï¼ˆä¸»ã‚­ãƒ¼ï¼‰
- `slug`: æ–‡å­—åˆ—ï¼ˆUIã§ä½¿ã†IDã€ä¾‹: "night-tournament-2025-01-30"ï¼‰
- `title`: æ–‡å­—åˆ—ï¼ˆä¾‹: "NIGHT TOURNAMENT"ï¼‰
- `description`: æ–‡å­—åˆ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€èª¬æ˜æ–‡ï¼‰
- `status`: æ–‡å­—åˆ—ï¼ˆ'scheduled' | 'live' | 'finished'ï¼‰
- `start_at`: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆé–‹å§‹æ™‚åˆ»ï¼‰
- `end_at`: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆçµ‚äº†æ™‚åˆ»ï¼‰
- `product_id`: UUIDï¼ˆå¯¾è±¡å•†å“ã€`products` ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å¤–éƒ¨ã‚­ãƒ¼ï¼‰
- `created_by`: UUIDï¼ˆä½œæˆè€…ã€brand / admin ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼‰
- `created_at`: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
- `updated_at`: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—

### 2. TournamentRankingRowï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡Œï¼‰

ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ Ã— ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ Ã— æŒ‡æ¨™ã®é›†è¨ˆãƒ“ãƒ¥ãƒ¼ã€‚

**å±æ€§**:
- `tournamentId`: æ–‡å­—åˆ—ï¼ˆãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆIDï¼‰
- `influencerId`: æ–‡å­—åˆ—ï¼ˆã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼IDï¼‰
- `influencerName`: æ–‡å­—åˆ—ï¼ˆã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼åã€å°†æ¥å®Ÿè£…ï¼‰
- `totalOrders`: æ•°å€¤ï¼ˆæ³¨æ–‡ä»¶æ•°ï¼‰
- `totalRevenue`: æ•°å€¤ï¼ˆå£²ä¸Šé‡‘é¡ï¼‰
- `rank`: æ•°å€¤ï¼ˆé †ä½ã€1ã‹ã‚‰é–‹å§‹ï¼‰

**æ³¨æ„**: MVP ã§ã¯ `influencerName` ã¯å°†æ¥å®Ÿè£…ï¼ˆç¾åœ¨ã¯ `profiles` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—å¯èƒ½ã ãŒã€MVPã§ã¯ç°¡ç•¥åŒ–ï¼‰ã€‚

### 3. TournamentEntryï¼ˆå‚åŠ ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼‰

ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã¸ã®å‚åŠ ã‚’è¡¨ç¾ï¼ˆMVPã§ã¯æ˜ç¤ºçš„ãªãƒ†ãƒ¼ãƒ–ãƒ«ã¯ä¸è¦ï¼‰ã€‚

**å®Ÿè£…æ–¹é‡**: 
- ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆæœŸé–“ä¸­ã«æ³¨æ–‡ãŒã‚ã£ãŸ Creator ã‚’è‡ªå‹•çš„ã«å‚åŠ è€…ã¨ã—ã¦æ‰±ã†
- `orders` ãƒ†ãƒ¼ãƒ–ãƒ«ã® `created_at` ã¨ `product_id` ã§åˆ¤å®š
- å°†æ¥çš„ã« `tournament_entries` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŒã€MVPã§ã¯ä¸è¦

---

## æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®æ´»ç”¨

### 1. `orders` ãƒ†ãƒ¼ãƒ–ãƒ«

**ä½¿ç”¨ç®‡æ‰€**:
- ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆæœŸé–“ä¸­ã®æ³¨æ–‡ã‚’å–å¾—ï¼ˆ`created_at` ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
- å¯¾è±¡å•†å“ã®æ³¨æ–‡ã‚’å–å¾—ï¼ˆ`product_id` ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
- Creator ã”ã¨ã®å£²ä¸Šã‚’é›†è¨ˆï¼ˆ`creator_id` ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼‰

**å¿…è¦ãªã‚«ãƒ©ãƒ **:
- `id`, `product_id`, `creator_id`, `amount`, `created_at`, `status`

### 2. `products` ãƒ†ãƒ¼ãƒ–ãƒ«

**ä½¿ç”¨ç®‡æ‰€**:
- ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã®å¯¾è±¡å•†å“æƒ…å ±ã‚’å–å¾—
- å•†å“åãƒ»ä¾¡æ ¼ãƒ»ç”»åƒãªã©ã®è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿

**å¿…è¦ãªã‚«ãƒ©ãƒ **:
- `id`, `name`, `price`, `image_url`, `owner_id`

### 3. `payouts` / `revenue-share` ãƒ­ã‚¸ãƒƒã‚¯

**ä½¿ç”¨ç®‡æ‰€**:
- å°†æ¥ã®æ‹¡å¼µ: ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆå ±é…¬ã®è¨ˆç®—
- MVP ã§ã¯ä½¿ç”¨ã—ãªã„ï¼ˆå ±é…¬è¦‹è¾¼ã¿ã®ã¿è¡¨ç¤ºï¼‰

### 4. æ—¢å­˜ã® `battles` ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã®é–¢ä¿‚

**æ—¢å­˜å®Ÿè£…**:
- `battles` ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ `battle_participants` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ—¢ã«å­˜åœ¨
- `DashboardClient.tsx` ã§ `fetchBattleStatus` ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

**æ–¹é‡**:
- æ—¢å­˜ã® `battles` ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ç¶­æŒï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼‰
- æ–°è¦ã« `tournaments` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ 
- å°†æ¥çš„ã« `battles` ã¨ `tournaments` ã‚’çµ±åˆã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŒã€MVPã§ã¯åˆ†é›¢

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 1. `tournaments` ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
-- tournaments: è²©å£²ãƒãƒˆãƒ« / ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã®å®šç¾©
create table if not exists public.tournaments (
  id uuid primary key default gen_random_uuid(),
  slug text unique not null, -- UIã§ä½¿ã†ID (ä¾‹: "night-tournament-2025-01-30")
  title text not null,
  description text,
  status text not null default 'scheduled', -- 'scheduled' | 'live' | 'finished'
  start_at timestamptz not null,
  end_at timestamptz not null,
  -- å¯¾è±¡å•†å“ï¼ˆMVPã§ã¯1å•†å“ï¼‰
  product_id uuid references public.products(id),
  -- ä½œæˆè€…ï¼ˆbrand / adminï¼‰
  created_by uuid references auth.users(id),
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
create index if not exists tournaments_status_idx on public.tournaments(status);
create index if not exists tournaments_product_id_idx on public.tournaments(product_id);
create index if not exists tournaments_start_at_idx on public.tournaments(start_at);
create index if not exists tournaments_end_at_idx on public.tournaments(end_at);

-- ã‚³ãƒ¡ãƒ³ãƒˆ
comment on table public.tournaments is 'è²©å£²ãƒãƒˆãƒ« / ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã®å®šç¾©';
comment on column public.tournaments.slug is 'UIã§ä½¿ã†IDï¼ˆURLãªã©ã§ä½¿ç”¨ï¼‰';
comment on column public.tournaments.status is 'ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: scheduledï¼ˆäºˆå®šï¼‰, liveï¼ˆé–‹å‚¬ä¸­ï¼‰, finishedï¼ˆçµ‚äº†ï¼‰';
comment on column public.tournaments.product_id is 'å¯¾è±¡å•†å“ï¼ˆMVPã§ã¯1å•†å“ã®ã¿ï¼‰';
```

### 2. RLS ãƒãƒªã‚·ãƒ¼ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

**ä½œæˆæ¨©é™**:
- `brand` / `company` ãƒ­ãƒ¼ãƒ«: è‡ªåˆ†ã®å•†å“ï¼ˆ`products.owner_id = auth.uid()`ï¼‰ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’ä½œæˆå¯èƒ½
- `admin` ãƒ­ãƒ¼ãƒ«: å…¨å•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’ä½œæˆå¯èƒ½

**é–²è¦§æ¨©é™**:
- `creator` / `influencer` ãƒ­ãƒ¼ãƒ«: å…¨ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’é–²è¦§å¯èƒ½ï¼ˆå‚åŠ çŠ¶æ³ã«é–¢ã‚ã‚‰ãšï¼‰
- `brand` / `company` ãƒ­ãƒ¼ãƒ«: è‡ªåˆ†ã®å•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’é–²è¦§å¯èƒ½
- `admin` ãƒ­ãƒ¼ãƒ«: å…¨ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’é–²è¦§å¯èƒ½

**å°†æ¥ã® RLS ãƒãƒªã‚·ãƒ¼ä¾‹**:
```sql
-- Brand / Company ã¯è‡ªåˆ†ã®å•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã®ã¿ä½œæˆå¯èƒ½
create policy "Brands can create tournaments for their products"
  on public.tournaments for insert
  with check (
    (auth.jwt() -> 'user_metadata' ->> 'role') IN ('brand', 'company')
    AND EXISTS (
      SELECT 1 FROM public.products
      WHERE products.id = tournaments.product_id
      AND products.owner_id = auth.uid()
    )
  );

-- Admin ã¯å…¨ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’ä½œæˆå¯èƒ½
create policy "Admins can create all tournaments"
  on public.tournaments for insert
  with check (
    (auth.jwt() -> 'user_metadata' ->> 'role') = 'admin'
  );

-- å…¨ãƒ­ãƒ¼ãƒ«ãŒå…¨ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’é–²è¦§å¯èƒ½ï¼ˆMVPã§ã¯ç°¡ç•¥åŒ–ï¼‰
create policy "All authenticated users can view tournaments"
  on public.tournaments for select
  using (auth.role() = 'authenticated');
```

**æ³¨æ„**: MVP ã§ã¯ RLS ãƒãƒªã‚·ãƒ¼ã¯å®Ÿè£…ã›ãšã€API Route å´ã§ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã€‚

---

## APIè¨­è¨ˆ

### 1. `GET /api/arena/tournaments`

**å½¹å‰²**: ç¾åœ¨/ç›´è¿‘ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆä¸€è¦§ã‚’è¿”ã™

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `status`ï¼ˆä»»æ„ï¼‰: `live` | `scheduled` | `finished`
- `product_id`ï¼ˆä»»æ„ï¼‰: ç‰¹å®šå•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```typescript
{
  tournaments: Tournament[]
}
```

**ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯**:
- `creator` / `influencer` / `brand` / `company` / `admin`: å…¨ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’é–²è¦§å¯èƒ½

### 2. `GET /api/arena/tournaments/[slug]`

**å½¹å‰²**: 1ã¤ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆè©³ç´°ã‚’è¿”ã™

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `slug`: ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã® slug

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```typescript
{
  tournament: Tournament & {
    product: {
      id: string;
      name: string;
      price: number;
      image_url: string | null;
    }
  }
}
```

**ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯**:
- `creator` / `influencer` / `brand` / `company` / `admin`: å…¨ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’é–²è¦§å¯èƒ½

### 3. `GET /api/arena/tournaments/[slug]/leaderboard`

**å½¹å‰²**: æŒ‡å®šãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¿”ã™

**ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `slug`: ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã® slug

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `limit`ï¼ˆä»»æ„ï¼‰: å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```typescript
{
  tournament: Tournament;
  rankings: TournamentRankingRow[];
  myRank: number | null; // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é †ä½ï¼ˆæœªèªè¨¼ã®å ´åˆã¯ nullï¼‰
}
```

**å®Ÿè£…**:
1. `tournaments` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å¯¾è±¡ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆå–å¾—
2. æœŸé–“ï¼ˆ`start_at` ã€œ `end_at`ï¼‰ã¨ `product_id` ã§ `orders` ã‚’å–å¾—
3. `buildTournamentRankingFromOrders` ã§é›†è¨ˆãƒ»rankä»˜ä¸
4. èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é †ä½ã‚’è¨ˆç®—

**ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯**:
- æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼: ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®ã¿é–²è¦§å¯èƒ½ï¼ˆ`myRank` ã¯ `null`ï¼‰
- `creator` / `influencer` / `brand` / `company` / `admin`: ãƒ©ãƒ³ã‚­ãƒ³ã‚° + è‡ªåˆ†ã®é †ä½ã‚’é–²è¦§å¯èƒ½

---

## UIè¨­è¨ˆ

### 1. Creator Dashboard

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: `src/components/dashboard/creator/CurrentTournamentCard.tsx`

**è¡¨ç¤ºé …ç›®**:
- ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆåï¼ˆä¾‹: "NIGHT TOURNAMENT"ï¼‰
- ç¾åœ¨ã®é †ä½ï¼ˆä¾‹: "#07 / NIGHT TOURNAMENT"ï¼‰
- æ¨å®šå ±é…¬ï¼ˆEst. Rewardï¼‰
- ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆscheduled / live / finishedï¼‰

**ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**:
- `/api/arena/tournaments?status=live` ã‹ã‚‰ã€Œä»Šã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã€ã‚’1ä»¶å–å¾—
- `/api/arena/tournaments/[slug]/leaderboard` ã‹ã‚‰è‡ªåˆ†ã®é †ä½ã‚’æŠ½å‡º

**é…ç½®**:
- æ—¢å­˜ã‚«ãƒ¼ãƒ‰ï¼ˆå£²ä¸Šãƒ»ã‚¯ãƒªãƒƒã‚¯æ•° ç­‰ï¼‰ã®è¿‘ãã«é…ç½®
- `DashboardCard` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨

**ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°/ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹**:
- Phase 4 ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¸è¥²ï¼ˆ`loadingState` / `errorState`ï¼‰
- ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆæœªé–‹å‚¬æ™‚: ã€Œç¾åœ¨å‚åŠ å¯èƒ½ãªãƒãƒˆãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“ã€ã¨è¡¨ç¤º

### 2. Brand Dashboard

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: `src/components/dashboard/brand/TournamentOverviewCard.tsx`

**è¡¨ç¤ºé …ç›®**:
- è‡ªç¤¾å•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆä¸€è¦§
- å‚åŠ ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æ•°
- æœ¬æ—¥æ™‚ç‚¹ã®å£²ä¸Šåˆè¨ˆ
- ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆscheduled / live / finishedï¼‰

**ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**:
- `/api/arena/tournaments?product_id=<brand_product_id>` ã‹ã‚‰å–å¾—
- ã¾ãŸã¯ API å†…éƒ¨ã§ brand ã® `company_id` ã‹ã‚‰ `product` ã‚’ç´ã¥ã‘ã¦ãƒ•ã‚£ãƒ«ã‚¿

**é…ç½®**:
- æ—¢å­˜ã‚«ãƒ¼ãƒ‰ï¼ˆå£²ä¸Šãƒ»å•†å“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ ç­‰ï¼‰ã®è¿‘ãã«é…ç½®
- `DashboardCard` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨

---

## å®Ÿè£…ã‚¿ã‚¹ã‚¯

### P8-A-1: ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­è¨ˆ & ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ âœ…
- [x] `docs/PHASE8_ARENA_PLAN.md` ã‚’ä½œæˆ

### P8-A-2: Supabase ã‚¹ã‚­ãƒ¼ãƒ
- [ ] `tournaments` ãƒ†ãƒ¼ãƒ–ãƒ«ã® SQL å®šç¾©ã‚’ä½œæˆ
- [ ] RLS ãƒãƒªã‚·ãƒ¼ã®æ–¹é‡ã‚’æ–‡æ›¸åŒ–ï¼ˆå®Ÿè£…ã¯å°†æ¥ï¼‰

### P8-A-3: ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ & ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¨ˆç®—
- [ ] `src/lib/arena/types.ts` ã‚’ä½œæˆ
- [ ] `src/lib/arena/ranking.ts` ã‚’ä½œæˆ
- [ ] `buildTournamentRankingFromOrders` ã‚’å®Ÿè£…

### P8-A-4: API Routes
- [ ] `GET /api/arena/tournaments` ã‚’å®Ÿè£…
- [ ] `GET /api/arena/tournaments/[slug]` ã‚’å®Ÿè£…
- [ ] `GET /api/arena/tournaments/[slug]/leaderboard` ã‚’å®Ÿè£…

### P8-A-5: Creator Dashboard çµ±åˆ
- [ ] `CurrentTournamentCard.tsx` ã‚’ä½œæˆ
- [ ] `DashboardClient.tsx` ã«çµ±åˆ

### P8-A-6: Brand Dashboard çµ±åˆ
- [ ] `TournamentOverviewCard.tsx` ã‚’ä½œæˆ
- [ ] `BrandDashboardClient.tsx` ã«çµ±åˆ

### P8-A-7: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ & ã¾ã¨ã‚
- [ ] `docs/PHASE8_ARENA_SUMMARY.md` ã‚’ä½œæˆ
- [ ] ã‚³ãƒ¼ãƒ‰ä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 

---

## æ—¢çŸ¥ã®åˆ¶ç´„ï¼ˆMVPï¼‰

1. **1ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ = 1å•†å“**: è¤‡æ•°å•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã¯æœªå¯¾å¿œ
2. **æ˜ç¤ºçš„ãªå‚åŠ ç™»éŒ²ä¸è¦**: æ³¨æ–‡ãŒã‚ã‚Œã°è‡ªå‹•å‚åŠ 
3. **ãƒ©ãƒ³ã‚­ãƒ³ã‚°æŒ‡æ¨™**: å£²ä¸Šé‡‘é¡ã®ã¿ï¼ˆã‚¯ãƒªãƒƒã‚¯æ•°ãƒ»CVR ã¯å°†æ¥ï¼‰
4. **è³é‡‘ãƒ­ã‚¸ãƒƒã‚¯**: å ±é…¬è¦‹è¾¼ã¿ã®ã¿è¡¨ç¤ºï¼ˆå®Ÿéš›ã®è³é‡‘æ”¯æ‰•ã„ã¯å°†æ¥ï¼‰
5. **RLS ãƒãƒªã‚·ãƒ¼**: API Route å´ã§ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ï¼ˆRLS ã¯å°†æ¥å®Ÿè£…ï¼‰

---

## å°†æ¥ã®æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢

1. **è¤‡æ•°å•†å“ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ**: `tournament_products` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ 
2. **ãƒãƒ¼ãƒ ãƒãƒˆãƒ«**: `tournament_teams` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ 
3. **è³é‡‘ãƒ­ã‚¸ãƒƒã‚¯**: `tournament_rewards` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ ã€`revenue-share.ts` ã¨çµ±åˆ
4. **ã‚¯ãƒªãƒƒã‚¯æ•°ãƒ»CVR æŒ‡æ¨™**: `affiliate_links` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã‚¯ãƒªãƒƒã‚¯æ•°ã‚’é›†è¨ˆ
5. **Fraud Radar ã¨ã®é€£æº**: ä¸æ­£æ¤œçŸ¥ã•ã‚ŒãŸæ³¨æ–‡ã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‹ã‚‰é™¤å¤–
6. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: Supabase Realtime ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/PHASE4_DASHBOARD_UX_PLAN.md`: Dashboard UI ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- `docs/PHASE6_AUTH_PLAN.md`: ãƒ­ãƒ¼ãƒ« & æ¨©é™ã®å®šç¾©
- `docs/PHASE7_PAYMENTS_PLAN.md`: æ±ºæ¸ˆãƒ»å ±é…¬ãƒ•ãƒ­ãƒ¼ã®è¨­è¨ˆ

