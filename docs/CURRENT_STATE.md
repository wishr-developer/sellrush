# SELL RUSH ç¾çŠ¶æ•´ç†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

æœ€çµ‚æ›´æ–°: 2025-12-02

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js 16.0.4 (App Router)
- **è¨€èª**: TypeScript 5
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS 4
- **èªè¨¼ãƒ»DB**: Supabase (@supabase/ssr ^0.7.0, @supabase/supabase-js ^2.84.0)
- **æ±ºæ¸ˆ**: Stripe ^20.0.0
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: Vercel (sellrush.vercel.app)
- **App Router ãƒ«ãƒ¼ãƒˆ**: `src/app/` ã®ã¿ï¼ˆãƒ«ãƒ¼ãƒˆç›´ä¸‹ã® `app/` ã¯å‰Šé™¤æ¸ˆã¿ï¼‰

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ app/                    # Next.js App Routerï¼ˆå”¯ä¸€ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
â”‚   â”œâ”€â”€ page.tsx           # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼ˆLPï¼‰
â”‚   â”œâ”€â”€ layout.tsx         # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ login/             # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ dashboard/         # ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼/ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ brand/             # ãƒ–ãƒ©ãƒ³ãƒ‰/ä¼æ¥­ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ admin/             # é‹å–¶ç®¡ç†è€…ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ api/               # API Routes
â”‚   â”‚   â”œâ”€â”€ stripe/        # Stripe Webhook
â”‚   â”‚   â”œâ”€â”€ checkout/      # Checkout Session ä½œæˆ
â”‚   â”‚   â”œâ”€â”€ affiliate-links/ # ç´¹ä»‹ãƒªãƒ³ã‚¯ç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”œâ”€â”€ components/            # å†åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ lib/                   # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»è¨­å®š
â”‚   â”œâ”€â”€ supabase.ts       # Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼‰
â”‚   â”œâ”€â”€ admin.ts          # ç®¡ç†è€…å‘ã‘ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ analytics.ts      # ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹
â”‚   â””â”€â”€ ...
â””â”€â”€ middleware.ts         # èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
```

## ğŸ›£ï¸ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ§‹é€ 

### å…¬é–‹ãƒšãƒ¼ã‚¸ï¼ˆèªè¨¼ä¸è¦ï¼‰
- `/` - ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼ˆLPï¼‰
- `/en` - è‹±èªç‰ˆLP
- `/login` - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
- `/activate` - ãƒ¡ãƒ¼ãƒ«èªè¨¼å®Œäº†ãƒšãƒ¼ã‚¸
- `/market` - å•†å“ä¸€è¦§ï¼ˆå…¬é–‹ï¼‰
- `/products` - å•†å“è©³ç´°ï¼ˆå…¬é–‹ï¼‰
- `/purchase` - è³¼å…¥ãƒšãƒ¼ã‚¸ï¼ˆå…¬é–‹ï¼‰
- `/purchase/success` - è³¼å…¥å®Œäº†ãƒšãƒ¼ã‚¸ï¼ˆå…¬é–‹ï¼‰

### ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼/ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ç”¨ï¼ˆèªè¨¼å¿…é ˆï¼‰
- `/dashboard` - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆå£²ä¸Šãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»ç´¹ä»‹ãƒªãƒ³ã‚¯ç”Ÿæˆï¼‰
- `/dashboard/orders` - æ³¨æ–‡ä¸€è¦§
- `/settings` - è¨­å®šãƒšãƒ¼ã‚¸

### ãƒ–ãƒ©ãƒ³ãƒ‰/ä¼æ¥­ç”¨ï¼ˆèªè¨¼å¿…é ˆï¼‰
- `/brand` - ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- `/brand/dashboard` - ãƒ–ãƒ©ãƒ³ãƒ‰ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆå£²ä¸Šãƒ»å•†å“ç®¡ç†ï¼‰
- `/brand/products` - å•†å“ç®¡ç†

### é‹å–¶ç®¡ç†è€…ç”¨ï¼ˆèªè¨¼ + MFAå¿…é ˆï¼‰
- `/admin` - ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- `/admin/login` - ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
- `/admin/mfa-setup` - MFAã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- `/admin/orders` - å…¨æ³¨æ–‡ç®¡ç†
- `/admin/payouts` - æ”¯æ‰•ã„ç®¡ç†
- `/admin/users` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- `/admin/fraud` - ä¸æ­£æ¤œçŸ¥

### API Routes
- `POST /api/checkout/create` - Stripe Checkout Session ä½œæˆ
- `POST /api/stripe/webhook` - Stripe Webhook ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- `POST /api/affiliate-links/create` - ç´¹ä»‹ãƒªãƒ³ã‚¯ç”Ÿæˆ
- `GET /api/rankings` - ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—ï¼ˆæœªå®Ÿè£…ï¼‰
- `POST /api/orders/create` - æ³¨æ–‡ä½œæˆ
- `POST /api/payouts/generate` - æ”¯æ‰•ã„ç”Ÿæˆ
- `POST /api/invitations/send` - æ‹›å¾…é€ä¿¡
- `POST /api/fraud/detect` - ä¸æ­£æ¤œçŸ¥
- `GET /api/admin/users` - ç®¡ç†è€…ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§

## ğŸ” èªè¨¼ãƒ»èªå¯ãƒ•ãƒ­ãƒ¼

### Supabase èªè¨¼
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´**: `src/lib/supabase.ts` ã§ `createClient` ã‚’ä½¿ç”¨
- **ã‚µãƒ¼ãƒãƒ¼å´**: `@supabase/ssr` ã® `createServerClient` ã‚’ä½¿ç”¨
- **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**: `src/middleware.ts` ã§èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆå…¬é–‹ãƒ‘ã‚¹ã¯é™¤å¤–ï¼‰

### ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰
- `creator` / `influencer` - ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼/ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼
- `company` / `brand` - ãƒ–ãƒ©ãƒ³ãƒ‰/ä¼æ¥­
- `admin` - é‹å–¶ç®¡ç†è€…ï¼ˆMFAå¿…é ˆï¼‰

### èªè¨¼ãƒ•ãƒ­ãƒ¼
1. `/login` ã§ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ã¦è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ:
   - `creator/influencer` â†’ `/dashboard`
   - `company/brand` â†’ `/brand/dashboard`
   - `admin` â†’ `/admin`ï¼ˆMFAç¢ºèªå¾Œï¼‰

## ğŸ’³ Stripe çµ±åˆ

### æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼
1. **Checkout Session ä½œæˆ** (`/api/checkout/create`)
   - å•†å“IDã¨ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ã‚’å—ã‘å–ã‚‹
   - Supabaseã§å•†å“ãƒ»ç´¹ä»‹ãƒªãƒ³ã‚¯ã‚’æ¤œè¨¼
   - Stripe Checkout Sessionã‚’ä½œæˆï¼ˆmetadataã«æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã¿ï¼‰

2. **Webhook å‡¦ç†** (`/api/stripe/webhook`)
   - `checkout.session.completed` ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡
   - `orders` ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ³¨æ–‡ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ
   - `payouts` ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ”¯æ‰•ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆ

### ç’°å¢ƒå¤‰æ•°
- `STRIPE_SECRET_KEY` - Stripe Secret Key
- `STRIPE_WEBHOOK_SECRET` - Webhookç½²åæ¤œè¨¼ç”¨

### æ³¨æ„ç‚¹
- Webhook ã§ã¯ `SUPABASE_SERVICE_ROLE_KEY` ã‚’ä½¿ç”¨ã—ã¦RLSã‚’ãƒã‚¤ãƒ‘ã‚¹
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: `NEXT_PUBLIC_SUPABASE_ANON_KEY`ï¼ˆéæ¨å¥¨ï¼‰

## ğŸ—„ï¸ Supabase çµ±åˆ

### ç’°å¢ƒå¤‰æ•°
- `NEXT_PUBLIC_SUPABASE_URL` - Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Supabase Anon Keyï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼‰
- `SUPABASE_SERVICE_ROLE_KEY` - Service Role Keyï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã€RLSãƒã‚¤ãƒ‘ã‚¹ç”¨ï¼‰

### ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ¨æ¸¬ï¼‰
- `orders` - æ³¨æ–‡
- `products` - å•†å“
- `affiliate_links` - ç´¹ä»‹ãƒªãƒ³ã‚¯
- `payouts` - æ”¯æ‰•ã„
- `users` / `profiles` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: `src/lib/supabase.ts` ã® `supabase` ã‚’ä½¿ç”¨
- **ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ/API Route**: `createServerClient` ã‚’ä½¿ç”¨
- **Webhook**: Service Role Key ã‚’ä½¿ç”¨ï¼ˆRLSãƒã‚¤ãƒ‘ã‚¹ï¼‰

## âš ï¸ æ—¢çŸ¥ã®å•é¡Œãƒ»æ”¹å–„ç‚¹

### 1. Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆã®ä¸çµ±ä¸€
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´: `createClient` ã‚’ä½¿ç”¨ï¼ˆ`@supabase/supabase-js`ï¼‰
- ã‚µãƒ¼ãƒãƒ¼å´: `createServerClient` ã‚’ä½¿ç”¨ï¼ˆ`@supabase/ssr`ï¼‰
- **å•é¡Œ**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚‚ `createServerClient` ã‚’ä½¿ã†ã¹ãã‹æ¤œè¨ãŒå¿…è¦

### 2. ç’°å¢ƒå¤‰æ•°ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- Webhook ã§ `SUPABASE_SERVICE_ROLE_KEY || NEXT_PUBLIC_SUPABASE_ANON_KEY` ã¨ã„ã†ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- **å•é¡Œ**: Service Role Key ãŒãªã„å ´åˆã« Anon Key ã‚’ä½¿ã†ã®ã¯å±é™º

### 3. ãƒ©ãƒ³ã‚­ãƒ³ã‚°APIæœªå®Ÿè£…
- `/api/rankings` ã¯ç©ºã®é…åˆ—ã‚’è¿”ã™ã ã‘
- **å•é¡Œ**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢æ•°ã¾ãŸã¯ãƒãƒ†ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ‰ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦

### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸çµ±ä¸€
- ä¸€éƒ¨ã®API Routeã§è©³ç´°ãªã‚¨ãƒ©ãƒ¼ã‚’è¿”ã—ã¦ã„ã‚‹
- ä¸€éƒ¨ã¯æ±ç”¨çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿
- **å•é¡Œ**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€ãŒå¿…è¦

### 5. å‹å®‰å…¨æ€§ã®ä¸è¶³
- Supabase ã®å‹å®šç¾©ãŒç”Ÿæˆã•ã‚Œã¦ã„ãªã„
- `any` å‹ãŒå¤šç”¨ã•ã‚Œã¦ã„ã‚‹
- **å•é¡Œ**: `supabase gen types` ã§å‹å®šç¾©ã‚’ç”Ÿæˆã™ã¹ã

### 6. `useSearchParams` ã®ä½¿ç”¨
- `/purchase` ã¨ `/purchase/success` ã§ Suspense ã§ãƒ©ãƒƒãƒ—æ¸ˆã¿
- **ç¢ºèªæ¸ˆã¿**: ä»–ã®ãƒšãƒ¼ã‚¸ã§ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‹è¦ç¢ºèª

## ğŸ“Š ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±è¨ˆ

- **ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 44ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`src/app` é…ä¸‹ï¼‰
- **`"use client"` ä½¿ç”¨**: 21ãƒ•ã‚¡ã‚¤ãƒ«
- **Supabase ä½¿ç”¨ç®‡æ‰€**: 35ãƒ•ã‚¡ã‚¤ãƒ«

## ğŸ”§ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```json
{
  "dev": "next dev",
  "build": "next build",
  "start": "next start",
  "lint": "eslint"
}
```

### ä¸è¶³ã—ã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `typecheck` - TypeScriptå‹ãƒã‚§ãƒƒã‚¯
- `lint:fix` - ESLintè‡ªå‹•ä¿®æ­£

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

è©³ç´°ãªå„ªå…ˆåº¦ä»˜ãã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã¯ `docs/TASK_PRIORITY.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

